(this.webpackJsonppricing=this.webpackJsonppricing||[]).push([[0],{181:function(e,t,n){},182:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(49),s=n.n(a),i=n(42),o=n(15),u=n(43),j=(n(172),n(12)),d=n(52),b=n(128);n(173),n(183);b.a.initializeApp({apiKey:"AIzaSyAP3J-XdlTdcxSNxWqq-s_oFjDrKRQiZWo",authDomain:"kivi-pu.firebaseapp.com",projectId:"kivi-pu",storageBucket:"kivi-pu.appspot.com",messagingSenderId:"548489968120",appId:"1:548489968120:web:26993108b29017326bbe0d"});var l=b.a.auth(),O=b.a.firestore(),p=n(38),h=n.n(p),x=n(53),f=n(202),m=n(198),g=n(69),v=n(14),y=n(96),w=n(146),C=n(148);function S(e,t){return Object.entries(e.reduce((function(e,n){var c=t(n);return e[c]=e[c]||[],e[c].push(n),e}),{}))}var k=n(21),I=n(25),L=function(){function e(t,n){Object(k.a)(this,e),this.names=void 0,this.products=void 0,this.names=t.split("/"),this.products=n}return Object(I.a)(e,[{key:"present",value:function(){return!(1===this.names.length&&""===this.names[0])}}]),e}(),H="UPDATE_ORDER",E="RESET_ORDER",R="SET_DATA",A={order:{}},D=Object(y.createStore)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:var n=t,c=n.product,r=n.amount;return Object(v.a)(Object(v.a)({},e),{},{order:Object(v.a)(Object(v.a)({},e.order),{},Object(g.a)({},c.id,{product:c,amount:r}))});case E:return Object(v.a)(Object(v.a)({},e),{},{order:{}});case R:var a=new C.a(t.products,{keys:["name"]}),s=S(t.products,(function(e){return e.category})).sort((function(e,t){var n=Object(j.a)(e,1)[0],c=Object(j.a)(t,1)[0];return n.localeCompare(c)})).map((function(e){var t=Object(j.a)(e,2),n=t[0],c=t[1];return new L(n,c)}));return Object(v.a)(Object(v.a)({},e),{},{fuse:a,categories:s});default:return e}}),Object(w.devToolsEnhancer)({}));function F(e,t){var n=e.getElementsByTagName(t);return n.length>=1&&n[0].textContent||""}var N=function e(t){Object(k.a)(this,e),this.id=void 0,this.name=void 0,this.price=void 0,this.count=void 0,this.category=void 0,this.id=F(t,"code"),this.name=F(t,"name"),this.price=F(t,"price"),this.count=F(t,"count"),this.category=F(t,"category")},T=n(201),B=n(101),P=n(184),z=n(195),J=n(3),_=Object(u.b)((function(e,t){var n;return{amount:(null===(n=e.order[t.product.id])||void 0===n?void 0:n.amount)||0}}),(function(e,t){return{setOrderAmount:function(n){return e({type:H,product:t.product,amount:n})}}}))((function(e){var t=e.amount,n=e.setOrderAmount,r=Object(c.useState)(),a=Object(j.a)(r,2),s=a[0],i=a[1];return 0===t&&void 0===s?Object(J.jsx)(P.a,{size:"mini",compact:!0,basic:!0,icon:"add",onClick:function(){return n(1)}}):Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(P.a,{size:"mini",compact:!0,basic:!0,icon:"plus",onClick:function(){return n(t+1)}}),Object(J.jsx)(z.a,{size:"mini",value:void 0===s?t:s,onChange:function(e){return i(e.target.value)},onBlur:function(){void 0!==s&&(n(parseInt(s)||0),i(void 0))}}),Object(J.jsx)(P.a,{size:"mini",compact:!0,basic:!0,icon:"minus",onClick:function(){return n(t-1)}})]})})),M=function(e){var t=e.product,n=e.isLoggedIn;return Object(J.jsxs)(m.a.Row,{children:[Object(J.jsx)(m.a.Cell,{className:"product-row-name",children:t.name}),Object(J.jsxs)(m.a.Cell,{singleLine:!0,children:[t.price," \u0433\u0440\u043d"]}),Object(J.jsx)(m.a.Cell,{singleLine:!0,className:"product-row-actions",children:"\u041e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f"===t.count?Object(J.jsx)(B.a,{color:"yellow",children:"\u041e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f"}):n?Object(J.jsx)(_,{product:t}):Object(J.jsx)(B.a,{color:"green",children:"\u0412 \u043d\u0430\u044f\u0432\u043d\u043e\u0441\u0442\u0456"})})]})},W=Object(c.memo)(M,(function(e,t){return e.isLoggedIn===t.isLoggedIn&&e.product.id===t.product.id})),q=function(e){var t=e.products,n=e.isLoggedIn;return Object(J.jsx)(J.Fragment,{children:Object(J.jsx)(m.a.Body,{children:t.map((function(e){return Object(J.jsx)(W,{product:e,isLoggedIn:n},e.id)}))})})},K=function(e){var t=e.names;return Object(J.jsx)(m.a.Header,{children:Object(J.jsx)(m.a.Row,{children:Object(J.jsx)(m.a.HeaderCell,{colSpan:3,children:Object(J.jsx)(T.a,{icon:"right angle",sections:t.map((function(e){return{key:e,content:e}}))})})})})},G=function(e){var t=e.categories,n=e.isLoggedIn;return Object(J.jsx)(J.Fragment,{children:t.map((function(e,t){return Object(J.jsxs)(c.Fragment,{children:[e.present()&&Object(J.jsx)(K,{names:e.names}),Object(J.jsx)(q,{products:e.products,isLoggedIn:n})]},t)}))})},Q=function(e){var t=e.onSearch,n=Object(c.useState)(""),r=Object(j.a)(n,2),a=r[0],s=r[1];return Object(c.useEffect)((function(){if(""!==a){var e=setTimeout((function(){return t(a)}),500);return function(){return clearTimeout(e)}}t(a)}),[a]),Object(J.jsx)(z.a,{fluid:!0,icon:"search",iconPosition:"left",value:a,onChange:function(e){return s(e.target.value)},action:Object(J.jsx)(P.a,{basic:!0,icon:"delete",onClick:function(){return s("")}})})},U=Object(c.memo)(Q);function X(){return(X=Object(x.a)(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://raw.githubusercontent.com/kivi-pu/products/master/products.xml");case 2:return t=e.sent,e.t0=new DOMParser,e.next=6,t.text();case 6:return e.t1=e.sent,n=e.t0.parseFromString.call(e.t0,e.t1,"text/xml"),e.abrupt("return",Array.from(n.getElementsByTagName("product")).map((function(e){return new N(e)})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=Object(u.b)((function(e){return e}),(function(e){return{setData:function(t){return e({type:R,products:t})}}}))((function(e){var t=e.isFirebaseLoading,n=e.isLoggedIn,r=e.fuse,a=e.categories,s=e.setData,i=Object(c.useState)(!1),o=Object(j.a)(i,2),u=o[0],d=o[1],b=function(e){var t=Object(c.useState)(),n=Object(j.a)(t,2),r=n[0],a=n[1];return[r,Object(c.useCallback)((function(t){var n;return a(""===t||null===e||void 0===e||null===(n=e.search(t))||void 0===n?void 0:n.map((function(e){return e.item})))}),[e])]}(r),l=Object(j.a)(b,2),O=l[0],p=l[1];return Object(c.useEffect)((function(){a&&r||(d(!0),function(){return X.apply(this,arguments)}().then((function(e){s(e),d(!1)})))}),[]),u||t?Object(J.jsx)(f.a,{basic:!0,attached:!0,loading:!0,className:"products-table-segment"}):Object(J.jsxs)(f.a,{basic:!0,attached:!0,className:"products-table-segment",children:[Object(J.jsx)(U,{onSearch:p}),Object(J.jsxs)(m.a,{unstackable:!0,compact:"very",children:[Object(J.jsx)(m.a.Header,{children:Object(J.jsxs)(m.a.Row,{children:[Object(J.jsx)(m.a.HeaderCell,{children:"\u041d\u0430\u0437\u0432\u0430"}),Object(J.jsx)(m.a.HeaderCell,{children:"\u0426\u0456\u043d\u0430"}),Object(J.jsx)(m.a.HeaderCell,{children:n?"\u0417\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f":"\u041d\u0430\u044f\u0432\u043d\u0456\u0441\u0442\u044c"})]})}),void 0===O?a&&Object(J.jsx)(G,{categories:a,isLoggedIn:n}):Object(J.jsx)(q,{products:O,isLoggedIn:n})]})]})})),V=n(197),Y=n(75),$=function(e){var t=e.isLoggedIn,n=e.hasOrder;return t?Object(J.jsxs)(V.a,{secondary:!0,attached:!0,children:[Object(J.jsxs)(V.a.Item,{onClick:function(){return l.signOut()},children:[Object(J.jsx)(Y.a,{name:"sign out"}),"\u0412\u0438\u0439\u0442\u0438"]}),Object(J.jsxs)(V.a.Menu,{className:"right",children:[n&&Object(J.jsxs)(V.a.Item,{as:function(e){return Object(J.jsx)(i.b,Object(v.a)({to:"/order"},e))},children:[Object(J.jsx)(Y.a,{name:"shop"}),"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043e \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f"]}),Object(J.jsxs)(V.a.Item,{as:function(e){return Object(J.jsx)(i.b,Object(v.a)({to:"/orders"},e))},children:[Object(J.jsx)(Y.a,{name:"history"}),"\u0406\u0441\u0442\u043e\u0440\u0456\u044f \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u044c"]})]})]}):null},ee=Object(c.memo)($),te=Object(u.b)((function(e){return{order:e.order}}))((function(e){var t=e.order,n=Object(d.a)(l),c=Object(j.a)(n,2),r=c[0],a=c[1];return Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(ee,{isLoggedIn:!!r,hasOrder:Object.values(t).filter((function(e){return e&&e.amount>0})).length>0}),Object(J.jsx)(Z,{isFirebaseLoading:a,isLoggedIn:!!r})]})})),ne=n(203),ce=n(199),re=n(196),ae=function(){var e=Object(d.a)(l),t=Object(j.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),s=Object(j.a)(a,2),i=s[0],u=s[1],b=Object(c.useState)(""),O=Object(j.a)(b,2),p=O[0],m=O[1],g=Object(c.useState)(!1),v=Object(j.a)(g,2),y=v[0],w=v[1],C=Object(c.useState)(),S=Object(j.a)(C,2),k=S[0],I=S[1];if(n)return Object(J.jsx)(o.a,{to:"/"});var L=function(){var e=Object(x.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w(!0),e.prev=1,e.next=4,l.signInWithEmailAndPassword(i,p);case 4:I(void 0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),I(e.t0.message);case 10:w(!1);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}();return Object(J.jsx)(ne.a,{className:"sign-in-page",verticalAlign:"middle",textAlign:"center",children:Object(J.jsxs)(ne.a.Column,{children:[k&&Object(J.jsx)(ce.a,{error:!0,content:k}),Object(J.jsx)(re.a,{onSubmit:L,loading:y||r,children:Object(J.jsxs)(f.a,{stacked:!0,children:[Object(J.jsx)(re.a.Input,{type:"email",placeholder:"\u0410\u0434\u0440\u0435\u0441 e-mail",icon:"user",iconPosition:"left",value:i,onChange:function(e){return u(e.target.value)}}),Object(J.jsx)(re.a.Input,{type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",icon:"lock",iconPosition:"left",value:p,onChange:function(e){return m(e.target.value)}}),Object(J.jsx)(re.a.Button,{icon:"sign in",content:"\u0423\u0432\u0456\u0439\u0442\u0438",fluid:!0})]})})]})})},se=Object(u.b)((function(e){return{items:Object.values(e.order).filter((function(e){return e&&e.amount>0})).map((function(e){return e}))}}),(function(e){return{resetOrder:function(){return e({type:E})}}}))((function(e){var t=e.items,n=e.resetOrder,r=Object(d.a)(l),a=Object(j.a)(r,2),s=a[0],u=a[1],b=Object(c.useState)(!1),p=Object(j.a)(b,2),g=p[0],y=p[1],w=Object(c.useState)(),C=Object(j.a)(w,2),S=C[0],k=C[1],I=Object(o.f)();if(!u&&!s||0===t.length)return Object(J.jsx)(o.a,{to:"/"});var L=function(){var e=Object(x.a)(h.a.mark((function e(){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.prev=1,c=t.map((function(e){var t=e.product,n=t.id,c=t.name,r=e.amount;return JSON.stringify({id:n,name:c,amount:r})})),e.next=5,O.collection("orders").add({uid:s.uid,date:new Date,products:c});case 5:k(void 0),n(),I.push("/"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),k(e.t0.message);case 13:y(!1);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();return Object(J.jsxs)(f.a,{basic:!0,loading:g||u,children:[S&&Object(J.jsx)(ce.a,{error:!0,content:S}),Object(J.jsxs)(m.a,{unstackable:!0,compact:"very",children:[Object(J.jsx)(m.a.Header,{children:Object(J.jsxs)(m.a.Row,{children:[Object(J.jsx)(m.a.HeaderCell,{children:"\u041d\u0430\u0437\u0432\u0430"}),Object(J.jsx)(m.a.HeaderCell,{children:"\u0426\u0456\u043d\u0430"}),Object(J.jsx)(m.a.HeaderCell,{children:"\u0417\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f"})]})}),Object(J.jsx)(q,{products:t.map((function(e){return e.product})),isLoggedIn:!0})]}),Object(J.jsxs)(P.a.Group,{fluid:!0,children:[Object(J.jsx)(P.a,{basic:!0,negative:!0,icon:"arrow left",content:"\u041d\u0430\u0437\u0430\u0434",as:function(e){return Object(J.jsx)(i.b,Object(v.a)({to:"/"},e))}}),Object(J.jsx)(P.a,{basic:!0,positive:!0,icon:"shop",content:"\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438 \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f",onClick:L})]})]})}));function ie(){return(ie=Object(x.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.collection("orders").where("uid","==",t).orderBy("date","desc").get();case 2:return n=e.sent,e.abrupt("return",n.docs.map((function(e){return{date:e.get("date").toDate(),products:e.get("products").map((function(e){return JSON.parse(e)}))}})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=function(){var e=Object(d.a)(l),t=Object(j.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)([]),s=Object(j.a)(a,2),u=s[0],b=s[1],O=Object(c.useState)(!0),p=Object(j.a)(O,2),h=p[0],x=p[1],g=Object(c.useState)(),y=Object(j.a)(g,2),w=y[0],C=y[1];return Object(c.useEffect)((function(){n&&function(e){return ie.apply(this,arguments)}(n.uid).then((function(e){b(e),C(void 0),x(!1)})).catch((function(e){C(e.message),x(!1)}))}),[n]),r||n?Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(V.a,{secondary:!0,attached:!0,children:Object(J.jsxs)(V.a.Item,{as:function(e){return Object(J.jsx)(i.b,Object(v.a)({to:"/"},e))},children:[Object(J.jsx)(Y.a,{name:"arrow left"}),"\u041d\u0430\u0437\u0430\u0434"]})}),Object(J.jsxs)(f.a,{basic:!0,attached:!0,loading:h||r,children:[w&&Object(J.jsx)(ce.a,{error:!0,content:w}),0===u.length?Object(J.jsx)(ce.a,{info:!0,content:"\u0423 \u0432\u0430\u0441 \u0449\u0435 \u043d\u0435\u043c\u0430\u0454 \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u044c"}):Object(J.jsxs)(m.a,{unstackable:!0,compact:"very",children:[Object(J.jsx)(m.a.Header,{children:Object(J.jsxs)(m.a.Row,{children:[Object(J.jsx)(m.a.HeaderCell,{children:"\u041d\u0430\u0437\u0432\u0430"}),Object(J.jsx)(m.a.HeaderCell,{children:"\u041a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044c"})]})}),u.map((function(e,t){var n=e.date,r=e.products;return Object(J.jsxs)(c.Fragment,{children:[Object(J.jsx)(m.a.Header,{children:Object(J.jsx)(m.a.Row,{children:Object(J.jsx)(m.a.HeaderCell,{colSpan:2,children:n.toString()})})}),Object(J.jsx)(m.a.Body,{children:r.map((function(e,t){var n=e.name,c=e.amount;return Object(J.jsxs)(m.a.Row,{children:[Object(J.jsx)(m.a.Cell,{children:n}),Object(J.jsx)(m.a.Cell,{children:c})]},t)}))})]},t)}))]})]})]}):Object(J.jsx)(o.a,{to:"/"})};n(181);s.a.render(Object(J.jsx)(r.a.StrictMode,{children:Object(J.jsx)(u.a,{store:D,children:Object(J.jsxs)(i.a,{children:[Object(J.jsx)(o.b,{exact:!0,path:"/signin",component:ae}),Object(J.jsx)(o.b,{exact:!0,path:"/order",component:se}),Object(J.jsx)(o.b,{exact:!0,path:"/orders",component:oe}),Object(J.jsx)(o.b,{exact:!0,path:"/",component:te})]})})}),document.getElementById("root"))}},[[182,1,2]]]);
//# sourceMappingURL=main.17a5c6dc.chunk.js.map