(this.webpackJsonppricing=this.webpackJsonppricing||[]).push([[0],{183:function(e,t,n){},184:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(50),i=n.n(a),s=n(43),o=n(15),u=n(61),j=(n(174),n(38)),d=n.n(j),b=n(12),l=n(52),O=n(53),h=n(204),m=n(70),p=n(14),f=n(97),x=n(148),v=n(150);function g(e,t){return Object.entries(e.reduce((function(e,n){var c=t(n);return e[c]=e[c]||[],e[c].push(n),e}),{}))}var y=n(22),w=n(23),k=function(){function e(t,n){Object(y.a)(this,e),this.key=void 0,this.names=void 0,this.products=void 0,this.key=t,this.names=t.split("/"),this.products=n}return Object(w.a)(e,[{key:"present",value:function(){return""!==this.key}},{key:"toItem",value:function(){return{type:"category",value:this}}}]),e}(),S="UPDATE_ORDER",I="RESET_ORDER",E="SET_DATA",C={order:{}},N=Object(f.createStore)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:var n=t,c=n.product,r=n.amount;return Object(p.a)(Object(p.a)({},e),{},{order:Object(p.a)(Object(p.a)({},e.order),{},Object(m.a)({},c.id,{product:c,amount:r}))});case I:return Object(p.a)(Object(p.a)({},e),{},{order:{}});case E:var a=new v.a(t.products,{keys:["name"]}),i=g(t.products,(function(e){return e.category})).sort((function(e,t){var n=Object(b.a)(e,1)[0],c=Object(b.a)(t,1)[0];return n.localeCompare(c)})).map((function(e){var t=Object(b.a)(e,2),n=t[0],c=t[1];return new k(n,c)}));return Object(p.a)(Object(p.a)({},e),{},{fuse:a,categories:i});default:return e}}),function(){try{var e=localStorage.getItem("order");return e?{order:JSON.parse(e)}:void 0}catch(t){return}}(),Object(x.devToolsEnhancer)({}));N.subscribe((function(){try{localStorage.setItem("order",JSON.stringify(N.getState().order))}catch(e){}}));var A=N,D=n(129);n(176),n(185);D.a.initializeApp({apiKey:"AIzaSyAP3J-XdlTdcxSNxWqq-s_oFjDrKRQiZWo",authDomain:"kivi-pu.firebaseapp.com",projectId:"kivi-pu",storageBucket:"kivi-pu.appspot.com",messagingSenderId:"548489968120",appId:"1:548489968120:web:26993108b29017326bbe0d"});var L=D.a.auth(),T=D.a.firestore();function z(e,t){var n=e.getElementsByTagName(t);return n.length>=1&&n[0].textContent||""}var P=function(){function e(t){Object(y.a)(this,e),this.id=void 0,this.name=void 0,this.price=void 0,this.count=void 0,this.category=void 0,this.id=z(t,"code"),this.name=z(t,"name"),this.price=z(t,"price"),this.count=z(t,"count"),this.category=z(t,"category")}return Object(w.a)(e,[{key:"toItem",value:function(){return{type:"product",value:this}}},{key:"key",get:function(){return this.id}}]),e}(),R=n(197),B=n(186),F=n(3),H=function(e){var t=e.onSearch,n=Object(c.useState)(""),r=Object(b.a)(n,2),a=r[0],i=r[1];return Object(c.useEffect)((function(){if(""!==a){var e=setTimeout((function(){return t(a)}),500);return function(){return clearTimeout(e)}}t(a)}),[a]),Object(F.jsx)(R.a,{fluid:!0,icon:"search",iconPosition:"left",value:a,onChange:function(e){return i(e.target.value)},action:Object(F.jsx)(B.a,{basic:!0,icon:"delete",onClick:function(){return i("")}})})},J=Object(c.memo)(H),W=n(141);function M(){var e=Object(c.useState)({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}),t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){function e(){r({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight})}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}var _=n(203),K=function(e){var t=e.style,n=e.category.names;return Object(F.jsx)(F.Fragment,{children:Object(F.jsx)("div",{className:"list-item category",style:t,children:Object(F.jsx)(_.a,{icon:"right angle",sections:n.map((function(e){return{key:e,content:e}}))})})})},q=n(102),G=n(76),Q=Object(u.b)((function(e,t){var n;return{amount:(null===(n=e.order[t.product.id])||void 0===n?void 0:n.amount)||0}}),(function(e,t){return{setOrderAmount:function(n){return e({type:S,product:t.product,amount:n})}}}))((function(e){var t=e.amount,n=e.setOrderAmount,r=Object(c.useState)(),a=Object(b.a)(r,2),i=a[0],s=a[1];return 0===t&&void 0===i?Object(F.jsx)(B.a,{size:"mini",compact:!0,basic:!0,icon:"add",onClick:function(){return n(1)}}):Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(B.a,{size:"mini",compact:!0,basic:!0,icon:"plus",onClick:function(){return n(t+1)}}),Object(F.jsx)(R.a,{size:"mini",type:"number",value:void 0===i?t:i,onChange:function(e){return s(e.target.value)},onBlur:function(){void 0!==i&&(n(parseInt(i)||0),s(void 0))}}),Object(F.jsx)(B.a,{size:"mini",compact:!0,basic:!0,icon:"minus",onClick:function(){return n(t-1)}})]})})),U=function(e){var t=e.style,n=e.product,c=e.isLoggedIn,r=M().width;return Object(F.jsxs)("div",{className:"list-item product",style:t,children:[Object(F.jsx)("div",{className:"product-row-name",children:n.name}),Object(F.jsxs)("div",{children:[n.price," \u0433\u0440\u043d"]}),Object(F.jsx)("div",{className:"product-row-actions",children:"\u041e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f"===n.count?Object(F.jsx)(q.a,{color:"yellow",children:r>600?"\u041e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f":Object(F.jsx)(G.a,{name:"clock"})}):c?Object(F.jsx)(Q,{product:n}):Object(F.jsx)(q.a,{color:"green",children:r>600?"\u0412 \u043d\u0430\u044f\u0432\u043d\u043e\u0441\u0442\u0456":Object(F.jsx)(G.a,{name:"check"})})})]})},X=Object(c.memo)((function(e){var t=e.height,n=e.windowWidth,r=e.isLoggedIn,a=e.items;return Object(F.jsx)(W.a,{width:"100%",height:t,itemCount:a.length,itemSize:r&&n<=600||n<=340?84:n<=425?71:n<=1024?52:35,itemKey:function(e){return a[e].value.key},overscanCount:5,className:"products-border",children:Object(c.memo)((function(e){var t=e.index,n=e.style,c=a[t];return"category"===c.type?Object(F.jsx)(K,{style:n,category:c.value}):Object(F.jsx)(U,{style:n,isLoggedIn:r,product:c.value})}),W.b)})})),Z=function(e){var t=e.isLoggedIn,n=e.categories,r=e.filteredProducts,a=M(),i=Object(c.useState)(a.height),s=Object(b.a)(i,2),o=s[0],u=s[1];Object(c.useEffect)((function(){a.height>o&&u(a.height)}),[a.height]);var j=Object(c.useMemo)((function(){return void 0!==r?r.map((function(e){return e.toItem()})):void 0!==n?n.flatMap((function(e){var t=e.products.map((function(e){return e.toItem()}));return e.present()?[e.toItem()].concat(t):t})):[]}),[n,r]);return Object(F.jsx)(h.a,{basic:!0,attached:!0,className:"products",children:Object(F.jsx)(X,{height:o-(t?155:115)-(a.width>425?14:0),windowWidth:a.width,items:j,isLoggedIn:t})})},V=n(199),Y=function(e){var t=e.isLoggedIn,n=e.hasOrder,c=M().width;return t?Object(F.jsxs)(V.a,{secondary:!0,attached:!0,children:[Object(F.jsxs)(V.a.Item,{onClick:function(){return L.signOut()},children:[Object(F.jsx)(G.a,{name:"sign out"}),"\u0412\u0438\u0439\u0442\u0438"]}),Object(F.jsxs)(V.a.Menu,{className:"right",children:[n&&Object(F.jsxs)(V.a.Item,{as:function(e){return Object(F.jsx)(s.b,Object(p.a)({to:"/order"},e))},children:[Object(F.jsx)(G.a,{name:"shop"}),c>600?"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0434\u043e \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f":"\u0417\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f"]}),Object(F.jsxs)(V.a.Item,{as:function(e){return Object(F.jsx)(s.b,Object(p.a)({to:"/orders"},e))},children:[Object(F.jsx)(G.a,{name:"history"}),c>600?"\u0406\u0441\u0442\u043e\u0440\u0456\u044f \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u044c":"\u0406\u0441\u0442\u043e\u0440\u0456\u044f"]})]})]}):null},$=Object(c.memo)(Y);function ee(){return(ee=Object(l.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://raw.githubusercontent.com/kivi-pu/products/master/products.xml");case 2:return t=e.sent,e.t0=new DOMParser,e.next=6,t.text();case 6:return e.t1=e.sent,n=e.t0.parseFromString.call(e.t0,e.t1,"text/xml"),e.abrupt("return",Array.from(n.getElementsByTagName("product")).map((function(e){return new P(e)})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var te=Object(u.b)((function(e){return e}),(function(e){return{setData:function(t){return e({type:E,products:t})}}}))((function(e){var t=e.order,n=e.fuse,r=e.categories,a=e.setData,i=Object(O.a)(L),s=Object(b.a)(i,2),o=s[0],u=s[1],j=Object(c.useState)(!1),d=Object(b.a)(j,2),l=d[0],m=d[1],p=function(e){var t=Object(c.useState)(),n=Object(b.a)(t,2),r=n[0],a=n[1];return[r,Object(c.useCallback)((function(t){var n;return a(""===t||null===e||void 0===e||null===(n=e.search(t))||void 0===n?void 0:n.map((function(e){return e.item})))}),[e])]}(n),f=Object(b.a)(p,2),x=f[0],v=f[1];return Object(c.useEffect)((function(){r&&n||(m(!0),function(){return ee.apply(this,arguments)}().then((function(e){a(e),m(!1)})))}),[]),l||u?Object(F.jsx)(h.a,{basic:!0,attached:!0,loading:!0}):Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)($,{isLoggedIn:!!o,hasOrder:Object.values(t).filter((function(e){return e&&e.amount>0})).length>0}),Object(F.jsx)(h.a,{basic:!0,attached:!0,children:Object(F.jsx)(J,{onSearch:v})}),Object(F.jsx)(h.a,{basic:!0,attached:!0,children:Object(F.jsxs)("div",{className:"list-header",children:[Object(F.jsx)("div",{children:"\u041d\u0430\u0437\u0432\u0430"}),Object(F.jsx)("div",{children:"\u0426\u0456\u043d\u0430"}),Object(F.jsx)("div",{children:o?"\u0417\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f":"\u041d\u0430\u044f\u0432\u043d\u0456\u0441\u0442\u044c"})]})}),Object(F.jsx)(Z,{isLoggedIn:!!o,categories:r,filteredProducts:x})]})})),ne=n(205),ce=n(201),re=n(198),ae=function(){var e=Object(O.a)(L),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),i=Object(b.a)(a,2),s=i[0],u=i[1],j=Object(c.useState)(""),m=Object(b.a)(j,2),p=m[0],f=m[1],x=Object(c.useState)(!1),v=Object(b.a)(x,2),g=v[0],y=v[1],w=Object(c.useState)(),k=Object(b.a)(w,2),S=k[0],I=k[1];if(n)return Object(F.jsx)(o.a,{to:"/"});var E=function(){var e=Object(l.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.prev=1,e.next=4,L.signInWithEmailAndPassword(s,p);case 4:I(void 0),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),I(e.t0.message);case 10:y(!1);case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(){return e.apply(this,arguments)}}();return Object(F.jsx)(ne.a,{className:"sign-in-page",verticalAlign:"middle",textAlign:"center",children:Object(F.jsxs)(ne.a.Column,{children:[S&&Object(F.jsx)(ce.a,{error:!0,content:S}),Object(F.jsx)(re.a,{onSubmit:E,loading:g||r,children:Object(F.jsxs)(h.a,{stacked:!0,children:[Object(F.jsx)(re.a.Input,{type:"email",placeholder:"\u0410\u0434\u0440\u0435\u0441 e-mail",icon:"user",iconPosition:"left",value:s,onChange:function(e){return u(e.target.value)}}),Object(F.jsx)(re.a.Input,{type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",icon:"lock",iconPosition:"left",value:p,onChange:function(e){return f(e.target.value)}}),Object(F.jsx)(re.a.Button,{icon:"sign in",content:"\u0423\u0432\u0456\u0439\u0442\u0438",fluid:!0})]})})]})})},ie=Object(u.b)((function(e){return{items:Object.values(e.order).filter((function(e){return e&&e.amount>0})).map((function(e){return e}))}}),(function(e){return{resetOrder:function(){return e({type:I})}}}))((function(e){var t=e.items,n=e.resetOrder,r=Object(O.a)(L),a=Object(b.a)(r,2),i=a[0],u=a[1],j=Object(c.useState)(!1),m=Object(b.a)(j,2),f=m[0],x=m[1],v=Object(c.useState)(),g=Object(b.a)(v,2),y=g[0],w=g[1],k=Object(o.f)();if(!u&&!i||0===t.length)return Object(F.jsx)(o.a,{to:"/"});var S=function(){var e=Object(l.a)(d.a.mark((function e(){var c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(!0),e.prev=1,c=t.map((function(e){var t=e.product,n=t.id,c=t.name,r=e.amount;return JSON.stringify({id:n,name:c,amount:r})})),e.next=5,T.collection("orders").add({uid:i.uid,date:new Date,products:c});case 5:w(void 0),n(),k.push("/"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),w(e.t0.message);case 13:x(!1);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();return f||u?Object(F.jsx)(h.a,{basic:!0,attached:!0,loading:!0}):Object(F.jsxs)(F.Fragment,{children:[y&&Object(F.jsx)(h.a,{basic:!0,attached:!0,children:Object(F.jsx)(ce.a,{error:!0,content:y})}),Object(F.jsx)(h.a,{basic:!0,attached:!0,children:Object(F.jsxs)("div",{className:"list-header",children:[Object(F.jsx)("div",{children:"\u041d\u0430\u0437\u0432\u0430"}),Object(F.jsx)("div",{children:"\u0426\u0456\u043d\u0430"}),Object(F.jsx)("div",{children:"\u0417\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f"})]})}),Object(F.jsx)(h.a,{basic:!0,attached:!0,className:"order-products",children:Object(F.jsx)("div",{children:t.map((function(e){var t=e.product;return Object(F.jsx)(U,{product:t,isLoggedIn:!0},t.id)}))})}),Object(F.jsx)(h.a,{basic:!0,attached:!0,className:"order-buttons",children:Object(F.jsxs)(B.a.Group,{fluid:!0,children:[Object(F.jsx)(B.a,{basic:!0,negative:!0,icon:"arrow left",content:"\u041d\u0430\u0437\u0430\u0434",as:function(e){return Object(F.jsx)(s.b,Object(p.a)({to:"/"},e))}}),Object(F.jsx)(B.a,{basic:!0,positive:!0,icon:"shop",content:"\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438 \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u043d\u044f",onClick:S})]})})]})})),se=n(200);function oe(){return(oe=Object(l.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.collection("orders").where("uid","==",t).orderBy("date","desc").get();case 2:return n=e.sent,e.abrupt("return",n.docs.map((function(e){return{date:e.get("date").toDate(),products:e.get("products").map((function(e){return JSON.parse(e)}))}})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=function(){var e=Object(O.a)(L),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)([]),i=Object(b.a)(a,2),u=i[0],j=i[1],d=Object(c.useState)(!0),l=Object(b.a)(d,2),m=l[0],f=l[1],x=Object(c.useState)(),v=Object(b.a)(x,2),g=v[0],y=v[1];return Object(c.useEffect)((function(){n&&function(e){return oe.apply(this,arguments)}(n.uid).then((function(e){j(e),y(void 0),f(!1)})).catch((function(e){y(e.message),f(!1)}))}),[n]),r||n?Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(V.a,{secondary:!0,attached:!0,children:Object(F.jsxs)(V.a.Item,{as:function(e){return Object(F.jsx)(s.b,Object(p.a)({to:"/"},e))},children:[Object(F.jsx)(G.a,{name:"arrow left"}),"\u041d\u0430\u0437\u0430\u0434"]})}),Object(F.jsxs)(h.a,{basic:!0,attached:!0,loading:m||r,children:[g&&Object(F.jsx)(ce.a,{error:!0,content:g}),0===u.length?Object(F.jsx)(ce.a,{info:!0,content:"\u0423 \u0432\u0430\u0441 \u0449\u0435 \u043d\u0435\u043c\u0430\u0454 \u0437\u0430\u043c\u043e\u0432\u043b\u0435\u043d\u044c"}):Object(F.jsxs)(se.a,{unstackable:!0,compact:"very",children:[Object(F.jsx)(se.a.Header,{children:Object(F.jsxs)(se.a.Row,{children:[Object(F.jsx)(se.a.HeaderCell,{children:"\u041d\u0430\u0437\u0432\u0430"}),Object(F.jsx)(se.a.HeaderCell,{children:"\u041a\u0456\u043b\u044c\u043a\u0456\u0441\u0442\u044c"})]})}),u.map((function(e,t){var n=e.date,r=e.products;return Object(F.jsxs)(c.Fragment,{children:[Object(F.jsx)(se.a.Header,{children:Object(F.jsx)(se.a.Row,{children:Object(F.jsx)(se.a.HeaderCell,{colSpan:2,children:n.toString()})})}),Object(F.jsx)(se.a.Body,{children:r.map((function(e,t){var n=e.name,c=e.amount;return Object(F.jsxs)(se.a.Row,{children:[Object(F.jsx)(se.a.Cell,{children:n}),Object(F.jsx)(se.a.Cell,{children:c})]},t)}))})]},t)}))]})]})]}):Object(F.jsx)(o.a,{to:"/"})};n(183);i.a.render(Object(F.jsx)(r.a.StrictMode,{children:Object(F.jsx)(u.a,{store:A,children:Object(F.jsxs)(s.a,{children:[Object(F.jsx)(o.b,{exact:!0,path:"/signin",component:ae}),Object(F.jsx)(o.b,{exact:!0,path:"/order",component:ie}),Object(F.jsx)(o.b,{exact:!0,path:"/orders",component:ue}),Object(F.jsx)(o.b,{exact:!0,path:"/",component:te})]})})}),document.getElementById("root"))}},[[184,1,2]]]);
//# sourceMappingURL=main.55e0d2f2.chunk.js.map